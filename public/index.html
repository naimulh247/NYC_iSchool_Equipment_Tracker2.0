<html>

<head>
    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>

    <script type="text/javascript" src="script.js"></script>

    <title>NYC iSchool Data Base Search Demo</title>
</head>

<body>
    <h2 id="pageTitle">NYC iSchool Data Base</h2>
        <form action="" name="FormFill" method="POST" onsubmit="return false"> 
                <div id="itemSearch">
                    <h6>Item search</h6>
                    <input type="search" id="search" name="crt_search"/>
                    <br/>
                    <input type="text" id="itemname" placeholder="Item Name" name="crt_itemName" />
                    <br>
                    <input type="text" id="model" placeholder="Model/Company" name="crt_model"/>
                    <br>
                    <input type="text" id="cost" placeholder="Cost" />
                        
                </div>
                <div id="StudentSearch">
                    <input type="search" id="studentID" />
                    <input type="text" id="advisor" placeholder="Advisor" name="crtadvisor" />
                    <input type="text" id="firstName" placeholder="Student First Name" name="crt_first_name"/>
                    <input type="text" id="lastName" placeholder="Student Last Name" name="crt_last_name"/>
                    <input type="text" id="parentEmail" placeholder="Parent Email" name="crt_parent_email"/>
                    <input type="text" id="authorized" placeholder="Authorized By" name="crt_authorization"/>
                    <input type="checkbox" class= "checkbox" name="ops[]" id="checkIn" >check in</input>
                    <input type="checkbox" class= "checkbox" name="ops[]" id="checkOut">check out</input>
                    <button id="btn" name="submit" onclick="send_data()">Submit</button>

                </div>
        </form>
    

    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
    <script type="text/javascript">
        $('#search').keyup(function() { //when key is pressed in search bar
            var searchTerm = $(this).val(); //val of search bar
            var myExp = new RegExp(searchTerm, "i"); //regular experation

            $.getJSON('/api', function(data) { //get the json file

                var itemnumber = "";
                var itemname = "";
                var model = "";
                var cost = "";
                $.each(data, function(key, val) {
                    if (val.ItemNumber.search(myExp) != -1) { //search for the data in the json file

                        itemname = val.ItemName;
                        model = val.ModelNumber;
                        cost = val.Cost;



                        
                    }
                }); 
                $('#itemnumber').val(itemnumber);
                $('#itemname').val(itemname);
                $('#model').val(model);
                $('#cost').val(cost);

            });
        });

        </script>
        <!-- // Student Search Engine: -->
    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
    <script type="text/javascript">
        $('#studentID').keyup(function() { //when key is pressed in search bar
            var searchTerms = $(this).val(); //val of search bar
            var myExps = new RegExp(searchTerms, "i"); //regular experation

            $.getJSON('/studentdb', function(data) { //get the json file

                var advisor = "";
                var firstname = "";
                var lastname = "";
                var parentemail = "";
                var authorized = "";
                $.each(data, function(key, val) {
                    if (val.StudentID.search(myExps) != -1) { //search for the data in the json file

                        advisor = val.Advisor
                        firstname = val.FirstName;
                        lastname = val.LastName;
                        parentemail = val.ParentEmail;
                        authorized = val.Authorized;



                        
                    }
                }); 
                    $('#advisor').val(advisor);
                    $('#firstName').val(firstname);
                    $('#lastName').val(lastname);
                    $('#parentEmail').val(parentemail);
                    $('#authorized').val(authorized);

            });
        });


    </script>

    <!-- Changing Form action -->
    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
    <script type="text/javascript">
        
        function send_data() {
            if  (document.getElementById('checkOut').checked == true){
                // alert("check out has been selected")
                $('form').submit(function() {
                     $.ajax({
                        async: false,
                        method: 'POST',
                        url: '/create_data',
                        data: $( this ).serialize(),
                
                     })
                     $.ajax({
                        async: false,
                        method: 'POST',
                        url: '/checkedout',
                        data: $( this ).serialize(),
                        
                
                             });
                     })
                     }
            else if(document.getElementById('checkIn').checked){
                         $('form').submit(function(){
                             $.ajax({
                                 async:false,
                                 method: 'POST',
                                 url: '/delete_data',
                                 data: $(this).serialize(),
                             })
                             $.ajax({
                                 async:false,
                                 method: 'POST',
                                 url: '/checkedin',
                                 data: $(this).serialize(),
                             });
                         })
                     }
                     else{
                         alert("Please check if the item is getting checked in or checked out")
                     }
            }
              
        
    </script>

</body>

</html>