<html>

<head>
    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
    <script type="text/javascript" src='./script.js'></script>
    <link rel="stylesheet" type="text/css" href="./style.css">

    <title>NYC iSchool Data Base </title>
</head>

<body>

    <header>
        <img src='logo.png' id="logo"/>
    
    
    </header>
        <form action="" name="FormFill" method="POST" id="fill" > 
                
                <div id="itemSearch"  >
                    <div id="wrapper">
                        <label >Item Number</label>
                            <br>
                            
                        <input type="search" id="search" class="customID" onkeyup="manage(this)" onsubmit="return false;" name="crt_search"/>
                            <br>
                            <br>
                        <label >Item Name</label>
                            <br>
                        <input type="text" class="customID" id="itemname"  name="crt_itemName" />
                            <br>
                            <br>
                        <label >Model</p>
                        <input type="text" id="model" class="customID"  name="crt_model"/>
                            <br>
                            <br>
                        <label >Replacement Cost</label>
                            <br>
                        <input type="text" id="cost"  class="customID" />
                    </div>        
                    
                    <div id="StudentSearch">
                        <div class="wrapperstudent">
                                <p>Student ID</p>
                                <input required="required" oninput="changebox()" autofocus="autofocus" type="search"  id="studentID">
                                <br>
                                <br>
                                <p>Advisor</p>
                                <input type="text" id="advisor" placeholder="Advisor" name="crtadvisor" />
                                <br>
                                <br>
                                <p>Student First Name</p>
                                <input type="text" id="firstName" placeholder="Student First Name" name="crt_first_name"/>
                                <br>
                                <br>
                                <p>Student Last Name</p>
                                <input type="text" id="lastName" placeholder="Student Last Name" name="crt_last_name"/>
                                <br>
                                <br>
                                <p>Parent Email</p>
                                <input type="text" id="parentEmail" placeholder="Parent Email" name="crt_parent_email"/>
                                <br>
                                <br>
                                <p>Authorized By Parents</p>
                                <input type="text" id="authorized" placeholder="Authorized By" name="crt_authorization"/>
                                <br>
                                <br>
                                <p>Loan Status</p>
                                <input type="radio" class= "checkbox" name="ops[]" id="checkOut" checked>Out to Student</input>
                                <br>
                                <input type="radio" class= "checkbox" name="ops[]" id="checkIn" >Returned</input>
                                <br>
                                
                                <!-- <button id="btn" name="submit">Submit</button> -->
                                <input type="submit" id="register" value="Submit" onclick="checkradio()" onsubmit="" disabled />

                                <!-- <input type="button" name="submit" span="submit"></input> -->
                                <script>
                                    function manage(search){
                                        var bt = document.getElementById('register');
                                        if (search.value != ''){
                                            bt.disabled = false;
                                        }
                                        else{
                                            bt.disabled = true;
                                        }
                                    }
                                    
                                </script>
                        </div>
                    </div>
                    </div>
        </form>
    

    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
    <script type="text/javascript">
            
        
        $('#search').keydown(function() { //when key is pressed in search bar
            var searchTerm = $(this).val(); //val of search bar
            var myExp = new RegExp(searchTerm, "i"); //regular experation

            $.getJSON('/api', function(data) { //get the json file

                var itemnumber = "";
                var itemname = "";
                var model = "";
                var cost = "";
                $.each(data, function(key, val) {
                    if (val.ItemNumber.search(myExp) != -1) { //search for the data in the json file

                        itemname = val.ItemName;
                        model = val.ModelNumber;
                        cost = val.Cost;



                        
                    }
                }); 
                $('#itemnumber').val(itemnumber);
                $('#itemname').val(itemname);
                $('#model').val(model);
                $('#cost').val(cost);

            });
        });
        

        </script>
        <!-- // Student Search Engine: -->
    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
    <script type="text/javascript">
        $('#studentID').keyup(function() { //when key is pressed in search bar
            var searchTerms = $(this).val(); //val of search bar
            var myExps = new RegExp(searchTerms, "i"); //regular experation
            if (document.getElementById('studentID') == 13){
                    $.getJSON('/studentdb', function(data) { //get the json file

                        var advisor = "";
                        var firstname = "";
                        var lastname = "";
                        var parentemail = "";
                        var authorized = "";
                        $.each(data, function(key, val) {
                            if (val.StudentID.search(myExps) != -1) { //search for the data in the json file

                                advisor = val.Advisor
                                firstname = val.FirstName;
                                lastname = val.LastName;
                                parentemail = val.ParentEmail;
                                authorized = val.Authorized;



                                
                            }
                        }); 
                            $('#advisor').val(advisor);
                            $('#firstName').val(firstname);
                            $('#lastName').val(lastname);
                            $('#parentEmail').val(parentemail);
                            $('#authorized').val(authorized);

                     });
                }else{
                    console.log("ID too short")
                }
        });


    </script>

    <!-- Changing Form action -->
    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
    <script type="text/javascript">
//         (function() {
//             $('form > input').keyup(function() {

//                 var empty = false;
//                 $('form > input').each(function() {
//                     if ($(this).val() == '') {
//                         empty = true;
//                     }
//                 });

//                 if (empty) {
//                     $('#register').attr('disabled', 'disabled');
//                 } else {
//                     $('#register').removeAttr('disabled');
//                 }
//     });
// })()

        function checkradio() {
            mytest();
            if(document.getElementById('checkOut').checked == true){
                console.log("checkout is clicked")
                $('form').submit(function(){
                        $.ajax({
                                async: false,
                                method: 'POST',
                                url: '/create_data',
                                data: $( this ).serialize(),
                        })

                        $.ajax({
                                async: false,
                                method: 'POST',
                                url: '/checkedout',
                                data: $( this ).serialize(),
                        })
                        
            })
        }
            else if (document.getElementById('checkIn').checked == true){
                $('form').submit(function(){
                        $.ajax({
                                async: false,
                                method: 'POST',
                                url: '/delete_data',
                                data: $( this ).serialize(),
                        })

                        $.ajax({
                                async: false,
                                method: 'POST',
                                url: '/checkedin',
                                data: $( this ).serialize(),
                        })
            })
            }
    }

        
    

        // function change2chkin(){
        //     $('form').submit(function(){
        //         $.ajax({
        //                 async: false,
        //                 method: 'POST',
        //                 url: '/delete_data',
        //                 data: $( this ).serialize(),
        //         })

        //         $.ajax({
        //                 async: false,
        //                 method: 'POST',
        //                 url: '/checkedin',
        //                 data: $( this ).serialize(),
        //         })
                
        //     })
        // }
        // function change2chkout(){
        //     $('form').submit(function(){
        //         $.ajax({
        //                 async: false,
        //                 method: 'POST',
        //                 url: '/create_data',
        //                 data: $( this ).serialize(),
        //         })
        //         $.ajax({
        //                 async: false,
        //                 method: 'POST',
        //                 url: '/checkedout',
        //                 data: $( this ).serialize(),
        //         })
            
        //     })
        // }
        








        // function send_data() {
            
        //     if  (document.getElementById('checkOut').checked == true ){
        //         // alert("check out has been selected")
        //         $('form').submit(function() {
        //              $.ajax({
        //                 async: false,
        //                 method: 'POST',
        //                 url: '/create_data',
        //                 data: $( this ).serialize(),
        //                 success: function(data){
        //                             if(data.success == true){ // if true (1)
        //                                 setTimeout(function(){// wait for 5 secs(2)
        //                                         location.reload(); // then reload the page.(3)
        //                                             }, 5000); 
        //                                                     }
        //                             }
                        
                
        //              })
        //              $.ajax({
        //                 async: false,
        //                 method: 'POST',
        //                 url: '/checkedout',
        //                 data: $( this ).serialize(),
                        
                            
        //                      });
        //              })
        //              }
        //     else if(document.getElementById('checkIn').checked== true && document.getElementById('checkOut').checked == false){
        //                  $('form').submit(function(){
        //                      $.ajax({
        //                          async:false,
        //                          method: 'POST',
        //                          url: '/delete_data',
        //                          data: $(this).serialize(),
        //                      })
        //                      $.ajax({
        //                          async:false,
        //                          method: 'POST',
        //                          url: '/checkedin',
        //                          data: $(this).serialize(),
        //                      });
        //                  })
        //              }
        //             //  else{
        //             //      alert("Please check if the item is getting checked in or checked out");
        //             //  }
                    //   event.preventDefault();

        //     }

              
        
    </script>

</body>

</html>